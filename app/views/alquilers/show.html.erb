<h1>VENTANA ALQUILER</h1>
<div class="container-fluid">
    <h2 id="valorR"></h2>
    <label for="customRange3" class="form-label">Eliga la cantidad de tiempo que desea alquilar este vehiculo:</label>
    <input id="barra" type="range" class="form-range" value="8" min="1" max="96" oninput="slider()">
    <output> Desliza y actualiza cantidad de </output> HS

    <div class="row  m-2">
        <div class="col card text-bg-dark mb-1 text-center"> 
            <div class="card-body">
                <h1 id="muestraPrecio" style="margin-bottom: 0"> $ARS= 0</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <button type="button" class="btn btn-primary" onclick="contratar()">Contratar</button>
        </div>

        <div class="col">
            <a href="/informes/new" type="button" class="btn btn-warning">Informar</a>
        </div>

        <div class="col">
            <a class="btn btn-danger" href="/"> Volver</a>
        </div>
    </div>
</div>

<script>
    const params2 = new URLSearchParams(document.location.search);
    let auto_in = params2.get("auto"); 
    valorR.innerText="El vehiculo a alquilar es el NÂ°" + auto_in;

    function slider() {
        barra.nextElementSibling.value = (barra.value/4);
        muestraPrecio.innerText="$ARS= "+ ((barra.value/4)*50);
    }
    function contratar(){  // Params (Nro auto, horas, usuario, valor)
        let monto= <%= @usuarios.first().monto_actual %>;
        let check=chequea(Number(auto_in), monto , (barra.value/4) ); // Num de error
        switch (check){
        case 1:
            console.log("El auto no esta ocupado y hay saldo "+location.host);
            let url = new URL(window.location.origin + "/alquilers");
            url.searchParams.set("auto",auto_in);
            url.searchParams.set("mins",(barra.value/4)*60);
            location.href = url
            return true;
            break;
        case 2:
            console.log("El auto esta en uso");
            return false;
            break;
        case 3:
            console.log("No hay saldo");        
            return false;
            break;
        case 4:
            console.log("Uso de auto reincidente");        
            return false;
            break;
        default: 
            console.log("chequea dio negativo o mas de 2 ni idea pa");
            return false;
        }   
    }
    function chequea(numAuto,monto,horas){ // Devuelve 0 si todo ok
        if (numAuto==1){ return 1 } //Esta en uso
        if (numAuto==2 && ((monto) < (horas*50))){ return 2 } // Plata insuficiente
        if (numAuto==3){ return 3 } // Ya lo uso hace -3h
        if (numAuto==4){ return 0 } // Este se puede usar
    }
</script>